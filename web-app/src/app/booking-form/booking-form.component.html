<div class="container" *ngIf="(tour$ | async) as tour " >
  <div class="travelers mat-elevation-z4" >
    <table mat-table class="mat-elevation-z3" style="width: 100%; background-color: rgba(253, 189, 189, 0.03)"
           [dataSource]="travelersTableData"
           multiTemplateDataRows
    >
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef  colspan="1">Name</th>
        <td mat-cell *matCellDef="let traveler" colspan="1">{{traveler?.name}}</td>
      </ng-container>
      <ng-container matColumnDef="email">
        <th mat-header-cell *matHeaderCellDef  colspan="1">Email</th>
        <td mat-cell *matCellDef="let traveler" colspan="1">{{traveler?.email}}</td>
      </ng-container>
      <ng-container matColumnDef="nationalId">
        <th mat-header-cell *matHeaderCellDef  colspan="2">National Id</th>
        <td mat-cell *matCellDef="let traveler" colspan="2">{{traveler?.nationalId}}</td>
      </ng-container>
      <ng-container matColumnDef="phone">
        <th mat-header-cell *matHeaderCellDef colspan="1">Phone</th>
        <td mat-cell *matCellDef="let traveler" colspan="1">{{traveler?.phone}}</td>
      </ng-container>
      <ng-container matColumnDef="actions" >
        <th mat-header-cell *matHeaderCellDef colspan="1">Actions</th>
        <td mat-cell *matCellDef="let traveler; let i = dataIndex;" colspan="1">
            <mat-icon style="color: red; font-size: 20px;" class="app-icon" (click)="removeTravelerHandler(i)">delete</mat-icon>
            <mat-icon style="color: blue; font-size: 20px;" class="app-icon"  (click)="enableEditTravelerMode(i)">edit</mat-icon>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
      <tr
        mat-row *matRowDef="let activity; columns: displayedColumns ; let i = index"></tr>
    </table>



    <form [formGroup]="form">
      <h2>Traveler Form</h2>
      <mat-divider style="padding: 10px 0"></mat-divider>
      <ng-container formArrayName="travelers">
        <ng-container *ngFor="let tr of travelers.controls; let i = index">
          <ng-container *ngIf="i == currentFormIndex" [formGroupName]="i">

            <mat-form-field class="field" appearance="outline"  >
              <mat-label>Name</mat-label>
              <input matInput type="text" placeholder="Name" formControlName="name" [errorStateMatcher]="matcher">
            </mat-form-field>
            <mat-form-field class="field" appearance="outline">
              <mat-label>Email</mat-label>
              <input matInput type="text" placeholder="Email" formControlName="email" [errorStateMatcher]="matcher">
            </mat-form-field>
            <mat-form-field class="field" appearance="outline">
              <mat-label>National Id</mat-label>
              <input matInput type="number" placeholder="nationalId" formControlName="nationalId" [errorStateMatcher]="matcher">
            </mat-form-field>
            <mat-form-field class="field" appearance="outline">
              <mat-label>Phone</mat-label>
              <input matInput type="text" placeholder="Phone" formControlName="phone" [errorStateMatcher]="matcher">
            </mat-form-field>

          </ng-container>
        </ng-container>
      </ng-container>
      <div class="btn-wrapper">
        <button mat-raised-button color="primary" [disabled]="form.invalid" *ngIf="!editMode" (click)="addTravelerHandler()">Add Traveler</button>
        <button mat-raised-button color="accent"   *ngIf="editMode" (click)="editTravelerHandler()">Edit Traveler</button>
      </div>
      <mat-divider style="margin: 12px"></mat-divider>
      <mat-form-field class="field" appearance="outline">
        <mat-label>Booking Description</mat-label>
        <textarea matInput   formControlName="description"
                  cdkTextareaAutosize [cdkAutosizeMinRows]="3"
                  [cdkAutosizeMaxRows]="5" ></textarea>
      </mat-form-field>

      <button mat-raised-button color="primary" style=" width: 100%; padding: 5px"  [disabled]="travelersTableData.length == 0"  (click)="bookingHandler(tour.name)">Book Now</button>

    </form>

  </div>
  <div class="tour-info">
    <mat-card *ngIf="(tour$ | async) as tour ">
      <img matCardImage [src]="tour?.imgUrl" >
      <mat-card-title >{{tour?.name}}</mat-card-title>
      <mat-card-content>
        {{tour?.description}}
      </mat-card-content>
      <mat-divider></mat-divider>
      <mat-card-actions >
        <button mat-raised-button color="primary" style=" width: 100%"  [disabled]="travelersTableData.length == 0"  (click)="bookingHandler(tour.name)">Book Now</button>
      </mat-card-actions>
    </mat-card>
  </div>
</div>
